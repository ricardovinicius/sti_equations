import streamlit as st

import solver

change_type_tips = {
    # Transforma√ß√µes diretamente usadas para isolar x
    "ADD_TO_BOTH_SIDES": "Adicione o mesmo valor aos dois lados da equa√ß√£o.",
    "SUBTRACT_FROM_BOTH_SIDES": "Subtraia o mesmo valor dos dois lados da equa√ß√£o.",
    "MULTIPLY_TO_BOTH_SIDES": "Multiplique os dois lados da equa√ß√£o pelo mesmo valor.",
    "DIVIDE_FROM_BOTH_SIDES": "Divida os dois lados da equa√ß√£o pelo mesmo valor.",
    "MULTIPLY_BOTH_SIDES_BY_INVERSE_FRACTION": "Multiplique ambos os lados pelo inverso da fra√ß√£o.",
    "MULTIPLY_BOTH_SIDES_BY_NEGATIVE_ONE": "Multiplique os dois lados por -1 para trocar o sinal.",
    "SWAP_SIDES": "Troque os lados da equa√ß√£o para facilitar a leitura.",

    # Simplifica√ß√µes alg√©bricas comuns
    "SIMPLIFY_ARITHMETIC": "Resolva contas simples (como somas ou multiplica√ß√µes).",
    "SIMPLIFY_LEFT_SIDE": "Simplifique a express√£o do lado esquerdo.",
    "SIMPLIFY_RIGHT_SIDE": "Simplifique a express√£o do lado direito.",
    "COLLECT_AND_COMBINE_LIKE_TERMS": "Agrupe e some os termos semelhantes.",
    "COLLECT_LIKE_TERMS": "Agrupe os termos semelhantes.",
    "REARRANGE_COEFF": "Reorganize os coeficientes para facilitar a leitura.",
    "ADD_POLYNOMIAL_TERMS": "Some os termos do polin√¥mio que s√£o semelhantes.",
    "ADD_COEFFICIENT_OF_ONE": "Adicione o coeficiente 1 onde ele est√° impl√≠cito.",
    "UNARY_MINUS_TO_NEGATIVE_ONE": "Converta o sinal de menos para -1 vezes o termo.",
    "REMOVE_ADDING_ZERO": "Remova a adi√ß√£o de zero, pois n√£o altera o valor.",
    "REMOVE_MULTIPLYING_BY_ONE": "Remova a multiplica√ß√£o por 1, pois n√£o altera o valor.",
    "REMOVE_MULTIPLYING_BY_NEGATIVE_ONE": "Remova a multiplica√ß√£o por -1 ao simplificar o sinal.",
    "RESOLVE_DOUBLE_MINUS": "Dois sinais de menos se anulam: transforme em mais.",

    # Simplifica√ß√µes envolvendo fra√ß√µes
    "SIMPLIFY_FRACTION": "Simplifique a fra√ß√£o dividindo numerador e denominador por um fator comum.",
    "SIMPLIFY_SIGNS": "Ajuste os sinais da fra√ß√£o (ex: -a/-b = a/b).",
    "CANCEL_TERMS": "Cancele termos iguais no numerador e denominador.",
    "CANCEL_MINUSES": "Elimine sinais de menos duplicados.",
    "MULTIPLY_BY_INVERSE": "Multiplique por uma fra√ß√£o invertida para facilitar a resolu√ß√£o.",

    # Verifica√ß√£o de conclus√£o
    "STATEMENT_IS_TRUE": "A equa√ß√£o foi resolvida corretamente (verdadeiro).",
    "STATEMENT_IS_FALSE": "A equa√ß√£o n√£o tem solu√ß√£o (falsa)."
}

# Main page content
st.markdown("# Math Tutor: First-Degree Equations")
st.sidebar.markdown("# Main page üéà")

# Inicializa estados
if "current_problem" not in st.session_state:
    st.session_state.current_problem = "2*x + 3 = 7"
if "solve_for" not in st.session_state:
    st.session_state.solve_for = "x"
if "user_answer" not in st.session_state:
    st.session_state.user_answer = ""
if "hint_pos" not in st.session_state:
    st.session_state.hint_pos = 0
if "solution_steps" not in st.session_state:
    st.session_state.solution_steps = solver.get_equation_solve_steps(st.session_state.current_problem)

# Fun√ß√£o para gerar novo problema (simula√ß√£o)
def gerar_novo_problema():
    # Aqui voc√™ pode integrar com um gerador real depois
    st.session_state.current_problem = "3*x - 4 = 5"
    st.session_state.solve_for = "x"
    st.session_state.user_answer = ""
    st.session_state.solution_steps = solver.get_equation_solve_steps(st.session_state.current_problem)
    st.session_state.hint_pos = 0

# Fun√ß√£o para exibir uma dica (simula√ß√£o)
def mostrar_dica():
    st.info(change_type_tips[st.session_state.solution_steps[st.session_state.hint_pos]["changeType"]])
    st.session_state.hint_pos += 1

@st.dialog("Cast your vote")
def display_result(result):
    st.write(f'{"Correct" if result else "Incorrect"} solution!')

with st.container(border=True):
    # T√≠tulo com emoji
    st.markdown("### üß† Current Problem")

    # Exibi√ß√£o do problema
    st.markdown(f"**Equa√ß√£o:**")
    st.markdown(f"#### {st.session_state.current_problem}")
    st.caption(f"**Resolva para:** `{st.session_state.solve_for}`")

    with st.form('problem'):
        st.session_state.user_answer = st.text_input("Sua resposta:", st.session_state.user_answer)
        submit = st.form_submit_button('Submit')

    if submit:
        display_result((solver.get_equation_solution(st.session_state.current_problem, st.session_state.solve_for) - float(st.session_state.user_answer) <= 0.0001))

    # Bot√µes adicionais
    col1, col2 = st.columns(2)

    with col1:
        if st.button("üí° Obter uma dica"):
            mostrar_dica()

    with col2:
        if st.button("üîÑ Novo problema"):
            gerar_novo_problema()

